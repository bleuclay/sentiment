<!DOCTYPE html>
<html>
	<head>
		<link href="css/style.css" rel="stylesheet">
	</head>
<body>

<div id="content">
	<div id="form">
		<h1>Sentiment checker</h1>

		<form>
			<input type="text" id="input">
			<button type="submit" id="button">Go</button>
		</form>

		<div class="average"></div>
		<p>Built by <a href="http://twitter.com/tobiaswright">@tobiaswright</a> and <a href="http://twitter.com/jorenerene">@jorenerene</a></p>
		<p>powered by <a href="http://metalayer.com">metaLayer</a> and <a href="http://twitter.com">Twitter</a></p>
	</div>
	<ul class="result"></ul>
</div>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script>

	var average=0;
	var average_num = 0,
		average_sum = 0;

var sentiment = function ( textinput ) {

	$.ajax({
		url: "process.php",
		dataType: 'json',
		data: { txt : {text : textinput}, service : "metalayer" },
		success: function(data) {
			var sentiment = data.response.datalayer.sentiment,
				themood = mood(sentiment);

				average_num++;
				average_sum += sentiment;
				average = average_sum / average_num;

			var statement = "<li>";
				statement += "<div class='face " + themood + "'></div>";
				statement += textinput;
				statement += "...";
				statement += "</li>";

			$(".result").prepend(statement);
		},
		error: function (xhr, ajaxOptions, thrownError) {
			console.log(xhr.status);
			console.log(thrownError);
		}
	});


}

var gettwitter = function (query) {
	$(".result").empty();

	$.ajax({
		url: "process.php",
		dataType: 'json',
		data: { service : "twitter", queryprocess : query },
		success: function(data) {
			$.each(data.statuses, function(i){
				sentiment(data.statuses[i].text);
			});

			console.log(average)
		},
		error: function (xhr, ajaxOptions, thrownError) {
			console.log(xhr.status);
			console.log(thrownError);
		}	
	});

	
}


var mood = function (sentiment) {
	var mood;

	if (sentiment > 0.4) mood = "reallyhappy";
	else if (sentiment > 0.1) mood = "happy";
	else if (sentiment > -0.1) mood = "neutral";
	else if (sentiment < -0.1) mood = "sad";
	else if (sentiment < -0.4 ) mood = "reallysad";

	return mood;
}

var moodAverage = function( sentiment ) {
	var average = 0,
		average_num = 0,
		average_sum = 0;

	average_num++;
	average_sum += sentiment;
	average = average_sum / average_num;

	return average;
}



$("form").submit( function() {
	gettwitter($("#input").val());
	return false;
});

</script>


</body>
</html>